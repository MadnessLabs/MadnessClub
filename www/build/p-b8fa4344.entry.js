import{r as i,c as t,h as o,a as e}from"./p-884d6dd0.js";async function n(i,t=1080,o=1080){return new Promise(((e,n)=>{try{let n=new Image;n.src=i,n.onload=()=>{let r;if(n.height<=o&&n.width<=t)r=i;else{n.height>n.width?t=Math.floor(o*(n.width/n.height)):o=Math.floor(t*(n.height/n.width));let i=document.createElement("canvas"),e=i.getContext("2d");i.width=n.width,i.height=n.height,e.drawImage(n,0,0,i.width,i.height);let h={width:Math.floor(n.width),height:Math.floor(n.height)},a={width:null,height:null};for(;.5*h.width>t;)a.width=Math.floor(.5*h.width),a.height=Math.floor(.5*h.height),e.drawImage(i,0,0,h.width,h.height,0,0,a.width,a.height),h.width=a.width,h.height=a.height;let s=document.createElement("canvas"),l=s.getContext("2d");s.width=t,s.height=o,l.drawImage(i,0,0,h.width,h.height,0,0,t,o),r=s.toDataURL("image/jpeg",1)}e(r)}}catch(i){n("Error resizing image!")}}))}let r=class{constructor(o){i(this,o),this.fireenjinUpload=t(this,"fireenjinUpload",7),this.ionInput=t(this,"ionInput",7),this.disabled=!1,this.showButton=!1,this.buttonText="Edit Image",this.type="photo",this.endpoint="upload",this.multiple=!1,this.resize=!1}onSuccess(i){if("upload"!==i.detail.endpoint||i.detail.name!==this.name)return!1;this.loading=!1}onPhotoChange(){this.updatePhoto()}componentDidLoad(){this.updatePhoto()}updatePhoto(){this.photoUrl=this.value?this.value:this.fallback?this.fallback:null,this.value&&this.ionInput.emit({name:this.name,value:this.value})}async triggerFileInput(i){if(this.disabled)return!1;this.photoUploaderEl.querySelector('input[type="file"]').click()}selectFile(i){var t;for(const o of(null===(t=null==i?void 0:i.target)||void 0===t?void 0:t.files)||[])this.uploadPhoto(o)}uploadPhoto(i){if(this.loading=!0,!window.FileReader)return;const t=new FileReader;t.onload=async t=>{var o,e;2==t.target.readyState&&(t.target.error?alert("Error while reading file"):this.fireenjinUpload.emit({event:t,endpoint:this.endpoint,name:this.name,data:{id:this.documentId,type:this.type,path:this.path,file:i,fileName:this.fileName,encodedContent:this.resize?n(null===(o=null==t?void 0:t.target)||void 0===o?void 0:o.result):null===(e=null==t?void 0:t.target)||void 0===e?void 0:e.result}}))},t.readAsDataURL(i)}onDrop(i){i.preventDefault(),this.uploadPhoto(i.dataTransfer.files[0])}onDrag(i){i.preventDefault()}onDragEnter(){this.showButton=!0}onDragLeave(){this.showButton=!1}render(){return o("div",null,o("div",{class:"upload-wrapper"},o("div",{class:this.loading?"photo is-loading":"photo",style:{backgroundImage:this.photoUrl?`url('${this.photoUrl}')`:null},onClick:i=>this.triggerFileInput(i),onDrop:i=>this.onDrop(i),onDragOver:i=>this.onDrag(i),onDragEnter:()=>this.onDragEnter(),onDragLeave:()=>this.onDragLeave()},!this.photoUrl&&this.initials?this.initials:null),this.showButton?o("ion-button",{fill:"clear",expand:"block",size:"small",onClick:i=>this.triggerFileInput(i)},this.buttonText,o("ion-icon",{name:"image",slot:"end"})):null),o("slot",null),o("input",{type:"file",onChange:i=>this.selectFile(i),accept:"image/*",multiple:this.multiple}))}get photoUploaderEl(){return e(this)}static get watchers(){return{value:["onPhotoChange"]}}};r.style='fireenjin-input-photo .upload-wrapper{display:block;margin:0 auto;height:150px;width:150px;position:relative}fireenjin-input-photo .upload-wrapper .photo{position:relative;background:var(--ion-color-medium);border-radius:4px;border:2px solid var(--ion-color-light);height:150px;width:150px;margin:0 auto;display:block;background-repeat:no-repeat;background-size:cover;background-position:center;color:var(--ion-color-medium);font-size:75px;line-height:150px;text-align:center;font-weight:bolder}fireenjin-input-photo .upload-wrapper .photo.is-loading:before{border-radius:4px}fireenjin-input-photo .upload-wrapper .photo.is-loading:after{border-radius:4px}fireenjin-input-photo .upload-wrapper .photo:hover{cursor:pointer;border-color:var(--ion-color-primary)}fireenjin-input-photo input[type="file"]{height:0;width:0;visibility:hidden;opacity:0;pointer-events:none;float:left}';export{r as fireenjin_input_photo}