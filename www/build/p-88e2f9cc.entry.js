import{r as i,c as t,B as n,h as o,H as a,d as s}from"./p-21a72a99.js";import{c as r,O as e,I as c}from"./p-1a77ebfe.js";import{L as h}from"./p-29d0604b.js";var l,d=(l=function(i,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])})(i,t)},function(i,t){function n(){this.constructor=i}l(i,t),i.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=new(function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return d(t,i),t.prototype.getCurrentPosition=function(i){return r(this,"getCurrentPosition",{callbackOrder:"reverse"},arguments)},t.prototype.watchPosition=function(i){return new e((function(t){var n=navigator.geolocation.watchPosition(t.next.bind(t),t.next.bind(t),i);return function(){return navigator.geolocation.clearWatch(n)}}))},t.pluginName="Geolocation",t.plugin="cordova-plugin-geolocation",t.pluginRef="navigator.geolocation",t.repo="https://github.com/apache/cordova-plugin-geolocation",t.install='ionic cordova plugin add cordova-plugin-geolocation --variable GEOLOCATION_USAGE_DESCRIPTION="To locate you"',t.installVariables=["GEOLOCATION_USAGE_DESCRIPTION"],t.platforms=["Amazon Fire OS","Android","Browser","iOS","Windows"],t}(c));const p=class{constructor(n){i(this,n),this.fireenjinTrigger=t(this,"fireenjinTrigger",7),this.mapMarkers=[],this.options={},this.visible=!0,this.markers=[],this.isVisible=!0}async addMarker(i){var t;this.google||(this.google=(null===(t=null===window||void 0===window?void 0:window.google)||void 0===t?void 0:t.maps)?window.google:await this.loadGoogleMaps());const n="string"==typeof i?JSON.parse(i):i,o=new this.google.maps.Marker({position:n.position,map:this.map,title:(null==n?void 0:n.name)||"",icon:(null==n?void 0:n.icon)?{url:n.icon,origin:new this.google.maps.Point(0,0),anchor:new this.google.maps.Point(15,15),scaledSize:new this.google.maps.Size(34,34),shape:{coords:[17,17,18],type:"circle"},optimized:!1}:null});return o.addListener("click",(()=>{this.onMarkerClick(o,n)})),this.mapMarkers.push(o),o}async updateMarkers(){return await this.clearMarkers(),this.markers.length>=1&&this.markers.map(this.addMarker.bind(this)),this.markers}async setMarkers(i=[]){return this.markers=i,await this.clearMarkers(),this.markers.length>=1&&this.markers.map(this.addMarker.bind(this)),this.markers}async setZoom(i){return this.map.setZoom(i)}async setCenter(i){return this.map.setCenter(i)}async clearMarkers(){var i;for(let t=0;t<this.mapMarkers.length;t++)(null===(i=this.mapMarkers[t])||void 0===i?void 0:i.setMap)&&this.mapMarkers[t].setMap(null);return this.mapMarkers=[],!0}onMarkerClick(i,t){this.map.setZoom(12),this.map.setCenter(i.getPosition()),this.fireenjinTrigger.emit({name:"markerClick",payload:{marker:i,location:t}})}getLocationCoords(i){try{u.getCurrentPosition().then((t=>{i&&"function"==typeof i&&i(t.coords)})).catch((async()=>{fetch("http://ip-api.com/json").then((async t=>{const n=await t.json();i({latitude:n.lat,longitude:n.lon})})),i&&"function"==typeof i&&i(!1)}))}catch(t){i(!1)}}async createMap(i){var t;this.google||(this.google=(null===(t=null===window||void 0===window?void 0:window.google)||void 0===t?void 0:t.maps)?window.google:await this.loadGoogleMaps()),this.map=new this.google.maps.Map(this.mapEl.querySelector("#map"),{zoom:9,center:{lat:i.latitude,lng:i.longitude}})}async loadGoogleMaps(i){return new h(this.googleMapsKey,i||{}).load()}async componentDidLoad(){var i;(null==n?void 0:n.isBrowser)&&(this.isVisible=this.visible,this.google=(null===(i=null===window||void 0===window?void 0:window.google)||void 0===i?void 0:i.maps)?window.google:await this.loadGoogleMaps(),setTimeout((()=>{this.getLocationCoords((async i=>{this.position=i||{latitude:38.6270025,longitude:-90.19940419999999},this.createMap(this.position),await this.setMarkers(this.markers)}))}),100))}render(){return o(a,{class:{"map-is-visible":this.isVisible}},o("div",{id:"map"}))}get mapEl(){return s(this)}static get watchers(){return{markers:["updateMarkers"]}}};p.style="fireenjin-map{position:relative;display:block}fireenjin-map #map{display:block;height:0px;width:100%;margin:0 auto;opacity:0;transition:all ease 0.5s}fireenjin-map.map-is-visible #map{height:var(--map-height, 300px);opacity:1}";export{p as fireenjin_map}